<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>LocalStora</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/starter-template.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="js/ie-emulation-modes-warning.js"></script>
	
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="css/bootstrap.min.css">

	<!-- Optional theme -->
	<link rel="stylesheet" href="css/bootstrap-theme.min.css">

	<!-- Latest compiled and minified JavaScript -->
	<script src="js/bootstrap.min.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	
	<!-- Mi javascript phonegap -->
	<script  src="phonegap.js"></script>
	<!--<script  src="js/mipropiojava.js"></script>	-->
	
	<script>
	var i_log = 0;
function mkLog(text){
	var date = new Date();
	var txt = i_log + " - " + date.getHours() + "-" + date.getMinutes() + "-" + date.getSeconds() + ": " + text; 
	i_log++;
	console.log(txt);
	$("#log").append(txt + '<br>');
}
	var existe_db
	var db


function onBodyLoad(){
	//mkLog("Ejecuté el onBodyLoad");
	document.addEventListener("deviceready", onDeviceReady, false);
}

function onDeviceReady(){
    //mkLog("Ejecuté el onDeviceReady");
	
	existe_db = window.localStorage.getItem("existe_db");	
	
	db = window.openDatabase("erp_mobile", "1.0", "Pedidos Offline", 200000);
	
	if(existe_db == null){
	    //mkLog("la BD es null");
		creaDB();
	}else{
		//mkLog("la BD está kkkk");
		cargaDatos();
	}

	//Habilita la función del botón atrás.
	document.addEventListener("backbutton", onBackKeyDown, false);	

	//Habilita la función del botón menú.
	document.addEventListener("menubutton", onMenuKeyDown, false);	
	
}

// Función activada. Botón Menú.
function onMenuKeyDown() {
	alert('No hay opciones de menu disponible por el momento.');
    }

function onBackKeyDown() {
            if( confirm("Realmente desea salir de la aplicación? Para navegar por esta app utilice los enlaces internos.") )
            {
                  navigator.app.exitApp();
            }
		}
		
function checkConnection() {
            var networkState = navigator.connection.type;

            var states = {};
            states[Connection.UNKNOWN]  = 'No podemos determinar tu tipo de conexión a una red de datos.';
            states[Connection.ETHERNET] = 'Estás conectado a la red mediante Ethernet connection, estamos listo para sincronizar los datos.';
            states[Connection.WIFI]     = 'Estás conectado a la red mediante WiFi, estamos listo para sincronizar los datos.';
            states[Connection.CELL_2G]  = 'Estás conectado a la red mediante Cell 2G connection, estamos listo para sincronizar los datos.';
            states[Connection.CELL_3G]  = 'Estás conectado a la red mediante Cell 3G connection, estamos listo para sincronizar los datos.';
            states[Connection.CELL_4G]  = 'Estás conectado a la red mediante Cell 4G connection, estamos listo para sincronizar los datos.';
            states[Connection.CELL]     = 'Estás conectado a la red mediante Cell generic connection, podrías experimentar lentitud en la sincronización.';
            states[Connection.NONE]     = '¡Atención! tu dispositivo no tiene conexion a datos, no podrás sincronizar, sin embargo podrás seguir trabajando de manera offline.';
			
			if(navigator.network.connection.type == Connection.NONE){
				// No tenemos conexión
				alert(states[networkState]);
			}else{
				// Si tenemos conexión
				alert(states[networkState]);
			}
			
            //alert(states[networkState]);
        }
		
/*
*Creación de base de datos
*/
function creaDB(){
	db.transaction(creaNuevaDB, errorDB, crearSuccess);
	}

function creaNuevaDB(tx){
	mkLog("Creando base de datos.");
	
	tx.executeSql('DROP TABLE IF EXISTS erp_paises');
	var sql = "CREATE TABLE IF NOT EXISTS erp_paises ( " +
	          "id INTEGER PRIMARY KEY AUTOINCREMENT, " +
			  "descripcion VARCHAR(50)," +
			  "sigla VARCHAR(5) )";
			  
	tx.executeSql(sql);

	tx.executeSql("INSERT INTO erp_paises (id, descripcion, sigla) VALUES (1, 'Argentina', 'AR')" );
	tx.executeSql("INSERT INTO erp_paises (id, descripcion, sigla) VALUES (2, 'Brasil', 'BR')" );
	tx.executeSql("INSERT INTO erp_paises (id, descripcion, sigla) VALUES (3, 'Bolivia', 'BO')" );
	tx.executeSql("INSERT INTO erp_paises (id, descripcion, sigla) VALUES (4, 'Colombia', 'CO')" );
	tx.executeSql("INSERT INTO erp_paises (id, descripcion, sigla) VALUES (5, 'Chile', 'CH')" );
	tx.executeSql("INSERT INTO erp_paises (id, descripcion, sigla) VALUES (6, 'Ecuador', 'EC')" );
	tx.executeSql("INSERT INTO erp_paises (id, descripcion, sigla) VALUES (7, 'Paraguay', 'PY')" );
	tx.executeSql("INSERT INTO erp_paises (id, descripcion, sigla) VALUES (8, 'Uruguay', 'UY')" );
}

function crearSuccess(){
	existe_db = window.localStorage.setItem("existe_db", 1);
	cargaDatos();
}

function errorDB(err){
	mkLog("Error procesando SQL:" + err.code);
	navigator.notification.alert("Error procesando SQL:" + err.code);
}

/*
*Cargar desde la base de datos
*/
function cargaDatos(){
	db.transaction(cargaRegistros, errorDB);
}

function cargaRegistros(tx){
	mkLog("Cargando registros de la base de datos.");
	tx.executeSql('select * from erp_paises', [], cargaDatosSuccess, errorDB);
}

function cargaDatosSuccess(tx, results){
	mkLog("Recibidos de la base de datos" + results.rows.length + " registros");
	if(results.rows.length == 0){
		mkLog("La tabla está vacía.");
		navigator.notification.alert("La tabla está vacía.");
	}
	
	for(var i=0; i<results.rows.length; i++){
		var paises = results.rows.item(i);
		var selector = $('#muestroresultado');
		selector.append('<tr>' +
							'<th scope="row">' + paises.id + '</th>' +
							'<td>' + paises.descripcion + '</td>' +
							'<td>' + paises.sigla + '</td>' +
						'</tr>');
	}
}	
	</script>

<style>
#muestroresultado{
	text-align: left;
}
</style>	
  </head>

  <body onload="onBodyLoad()">

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">ItsClient</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span> Pedidos de Ventas</a>
        </div>
		<div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><button class="btn btn-info btn-xs" type="button" onclick="checkConnection()"><span class="glyphicon glyphicon-signal" aria-hidden="true"></span> Chequear conexión</button></li>
          </ul>	  
        </div><!--/.nav-collapse -->		
      </div>
    </nav>

    <div class="container">
		<div id="row">
			<div class="starter-template">
				<ol class="breadcrumb">
				  <li><a href="#">Ventas</a></li>
				  <li class="active">Pedidos de ventas</li>
				</ol>

				<table class="table">
				  <caption>Paises disponibles</caption>
				  <thead>
					<tr>
					  <th>Código</th>
					  <th>Descripción</th>
					  <th>Siglas</th>
					</tr>
				  </thead>
				  <tbody id="muestroresultado">
				  </tbody>
				</table>			
			</div>
	<hr>
			<ol class="breadcrumb">
			  <li><a href="#">General</a></li>
			  <li class="active">Parámetros</li>
			</ol>
			<form>
			  <div class="form-group">
				<label for="ws"><small>Web Service</small></label>
				<input type="text" class="form-control" id="ws" name="ws" placeholder="http://Servidor/ITSWS/ItsCliSvrWS.asmx?WSDL">
			  </div>
			  <div class="form-group">
				<label for="bd"><small>Base de datos</small></label>
				<input type="text" class="form-control" id="bd" name="bd" placeholder="BASEDEMO">
			  </div>
			  <div class="form-group">
				<label for="user"><small>Usuario</small></label>
				<input type="text" class="form-control" id="user" name="bd" placeholder="Usuario">
			  </div>
			  <div class="form-group">
				<label for="pass"><small>Password</small></label>
				<input type="password" class="form-control" id="pass" name="pass" placeholder="123456">
			  </div>

			  <button type="submit" class="btn btn-default"><span class="glyphicon glyphicon-floppy-saved" aria-hidden="true"></span> <small>Guardar</small></button>
			</form>
	<hr>
			<ol class="breadcrumb">
			  <li><a href="#">General</a></li>
			  <li class="active">Descargar</li>
			</ol>
	<hr>
			<ol class="breadcrumb">
			  <li><a href="#">General</a></li>
			  <li class="active">Pedidos</li>
			</ol>			
	<hr>
			<ol class="breadcrumb">
			  <li><a href="#">General</a></li>
			  <li class="active">Enviar datos</li>
			</ol>
			
		</div>
    </div><!-- /.container -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="js/ie10-viewport-bug-workaround.js"></script>

	<!--DATOS PERSONALES Envia datos a otra página y devuelve resultado-->
	<script src="js/jquery-1.10.2.js"></script>	
	<!--<script language="javascript" src="js/jquery-1.3.min.js"></script>-->

	<!-- CONTACTO -->	
		<script language="javascript">
		  $(document).ready(function() {
		   $().ajaxStart(function() {
		   $('#conecto').show();
	       $('#muestroresultado').hide();

			}).ajaxStop(function() {
			$('#conecto').hide();
			$('#muestroresultado').fadeIn('slow');
			});
		  $('#form, #fat, #test').submit(function() {
			   $('#muestroresultado').hide();
			   $('#conecto').show();
			$.ajax({
				type: 'post',
				url: $(this).attr('action'),
				data: $(this).serialize(),
				success: function(data) {
				$('#conecto').hide();
				$('#muestroresultado').fadeIn('slow');
				$('#muestroresultado').html(data);
				}
			})  
			return false;
			 }); 
			})  
		</script>	
	
  </body>
</html>